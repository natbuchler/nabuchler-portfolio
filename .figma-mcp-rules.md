# Figma MCP Integration Rules

> **CRITICAL**: These rules define how to translate Figma inputs into code for this project and must be followed for every Figma-driven change.

## üö® MCP Assets - CRITICAL RULES

**The Figma MCP server provides an assets endpoint that serves all images and SVGs.**

### Mandatory Asset Handling:

1. ‚úÖ **USE localhost sources directly**
   - When Figma MCP returns `http://localhost:XXXX/assets/...`, use it as-is
   - These are real assets from your Figma file, not placeholders

2. ‚ùå **NEVER install icon packages**
   - DO NOT use `react-icons`, `heroicons`, `lucide-react`, etc.
   - All icons come from Figma via MCP assets endpoint

3. ‚ùå **NEVER create placeholders**
   - DO NOT use temporary images
   - DO NOT create placeholder SVGs
   - DO NOT use fallback icons

**If a localhost source is provided, it is the source of truth. Use it.**

## üîÑ Required Flow (DO NOT SKIP)

### Step 1: Get Code
Run `get_code` first to fetch the structured representation for the exact node(s).

```typescript
// Example
await mcp__figma__get_code({
  fileKey: "KBKaj4z9hPZRv26GbNFSUz",
  nodeId: "3211:1217",
  clientLanguages: "typescript,jsx",
  clientFrameworks: "react,nextjs,tailwind"
});
```

### Step 2: Handle Large Responses
If the response is too large or truncated:
1. Run `get_metadata` to get the high-level node map
2. Re-fetch only the required node(s) with `get_code`

```typescript
// Get metadata first
await mcp__figma__get_metadata({
  fileKey: "KBKaj4z9hPZRv26GbNFSUz",
  nodeId: "0:1", // Root or page level
  clientLanguages: "typescript",
  clientFrameworks: "react"
});

// Then get specific nodes
await mcp__figma__get_code({
  fileKey: "KBKaj4z9hPZRv26GbNFSUz",
  nodeId: "specific-node-id",
  clientLanguages: "typescript,jsx",
  clientFrameworks: "react,nextjs,tailwind"
});
```

### Step 3: Get Screenshot
Run `get_screenshot` for a visual reference of the node variant being implemented.

```typescript
await mcp__figma__get_screenshot({
  fileKey: "KBKaj4z9hPZRv26GbNFSUz",
  nodeId: "3211:1217",
  clientLanguages: "typescript",
  clientFrameworks: "react"
});
```

### Step 4: Handle Assets from Figma MCP

**CRITICAL ASSET RULES:**

‚ö†Ô∏è **The Figma MCP server provides an assets endpoint which serves image and SVG assets**

1. **Use localhost sources directly**
   - If Figma MCP returns a `localhost` source for an image/SVG, **USE IT DIRECTLY**
   - Example: `http://localhost:3000/assets/icon-123.svg`

2. **DO NOT import new icon packages**
   - ‚ùå **NEVER** add `react-icons`, `heroicons`, or any icon library
   - ‚úÖ All assets should come from the Figma payload

3. **DO NOT use placeholders**
   - ‚ùå **NEVER** create placeholder images if localhost source is provided
   - ‚ùå **NEVER** use temporary icons/images
   - ‚úÖ Use the actual asset URL from Figma MCP

**Example - Correct Asset Usage:**
```typescript
// ‚úÖ Correct - Using localhost source from Figma MCP
const codeResponse = await mcp__figma__get_code({...});

// Response includes assets:
// {
//   code: "...",
//   assets: {
//     "icon-id-123": "http://localhost:3000/assets/icon-123.svg"
//   }
// }

// Use it directly:
<img src="http://localhost:3000/assets/icon-123.svg" alt="Icon" />

// Or with Next.js Image:
<Image
  src="http://localhost:3000/assets/icon-123.svg"
  alt="Icon"
  width={24}
  height={24}
/>
```

**Example - WRONG Asset Usage:**
```typescript
// ‚ùå Wrong - Installing new icon package
import { FiHome } from 'react-icons/fi';

// ‚ùå Wrong - Using placeholder
<img src="/placeholder-icon.svg" alt="Icon" />

// ‚ùå Wrong - Creating temporary icon
<div className="w-6 h-6 bg-gray-400 rounded" />
```

Only after you have `get_code`, `get_screenshot`, and identified all assets, start implementation.

### Step 5: Translate to Project Conventions
Translate the output (usually React + Tailwind) into this project's conventions, styles and framework.

**Reuse:**
- Project's color tokens from `src/lib/design-tokens.ts`
- Existing components from `src/components/ui/`
- Typography system from design tokens
- Spacing and layout tokens

### Step 6: Validate
Validate against Figma for 1:1 look and behavior before marking complete.

---

## üìã Implementation Rules

### 1. Code Translation
- ‚ùå **DO NOT**: Copy Figma MCP output (React + Tailwind) directly
- ‚úÖ **DO**: Treat it as a representation of design and behavior, not final code style

### 2. Styling Approach
- ‚ùå **DO NOT**: Use raw Tailwind utility classes when design tokens exist
- ‚úÖ **DO**: Replace Tailwind classes with project's design tokens

**Example:**
```typescript
// ‚ùå Wrong - Direct Tailwind from Figma
<div className="bg-[#421d13] text-[#e3dcd6]">

// ‚úÖ Correct - Using design tokens
<div className="bg-brown text-background">
```

### 3. Component Reuse
- ‚úÖ **ALWAYS** reuse existing components:
  - `src/components/ui/Icon.tsx`
  - `src/components/ui/Typography.tsx`
  - `src/components/ui/Card.tsx`
  - `src/components/ui/Timeline.tsx`
  - `src/components/Button.tsx`

- ‚ùå **DO NOT** duplicate functionality

**Example:**
```typescript
// ‚ùå Wrong - Creating new button
<button className="bg-brown text-background px-6 py-2">

// ‚úÖ Correct - Using existing Button component
import Button from '@/components/Button';
<Button variant="primary">Click me</Button>
```

### 4. Design System Consistency

**Use project's systems:**
```typescript
import { colors, typography, spacing } from '@/lib/design-tokens';

// Colors
colors.brown         // #421d13
colors.beige         // #ad8a6c
colors.background    // #e3dcd6
colors.orange        // #c95127

// Typography
typography.fonts.playfair
typography.fonts.robotoFlex
typography.fontSizes.xl
typography.fontWeights.bold

// Spacing
spacing['4']  // 1rem
spacing['8']  // 2rem
```

### 5. Respect Existing Patterns
- ‚úÖ Use existing routing patterns
- ‚úÖ Follow state management conventions (useState, useEffect)
- ‚úÖ Match data-fetch patterns (async/await)
- ‚úÖ Follow file organization structure

### 6. Visual Parity Priority
- üéØ **PRIMARY GOAL**: 1:1 visual match with Figma
- When conflicts arise:
  1. Prefer design-system tokens
  2. Adjust spacing/sizes minimally to match visuals
  3. Document any intentional deviations

### 7. Final Validation Checklist

Before marking complete, verify:

- [ ] `get_code` output reviewed and translated
- [ ] `get_screenshot` compared with implementation
- [ ] All assets downloaded and optimized
- [ ] Design tokens used instead of hardcoded values
- [ ] Existing components reused where possible
- [ ] Typography matches Figma
- [ ] Colors match exactly (use design tokens)
- [ ] Spacing matches Figma layout
- [ ] Responsive behavior implemented
- [ ] Accessibility (ARIA labels, semantic HTML)
- [ ] Build passes (`npm run build`)
- [ ] Visual regression tested

---

## üé® Project-Specific Conventions

### File Placement
```
New UI Components     ‚Üí src/components/ui/
New Page Sections     ‚Üí src/components/sections/
New Features          ‚Üí src/components/features/
New Utilities         ‚Üí src/lib/
```

### Component Documentation
```typescript
/**
 * Component Name
 *
 * Brief description of what it does.
 * Mention if it's from Figma and the source node.
 *
 * @component
 * @example
 * ```tsx
 * <ComponentName prop="value" />
 * ```
 */
```

### Import Order
```typescript
// 1. React & Next.js
import React from 'react';
import Image from 'next/image';

// 2. External libraries
import { motion } from 'framer-motion';

// 3. Internal UI components
import Button from '@/components/Button';
import { TitleSubTitle } from '@/components/ui/Typography';

// 4. Design tokens & utilities
import { colors, typography } from '@/lib/design-tokens';

// 5. Types & interfaces
import type { ComponentProps } from './types';
```

---

## üö´ Common Mistakes to Avoid

### Assets (MOST CRITICAL)
1. **‚ùå Installing icon packages** - DO NOT add `react-icons`, `heroicons`, etc.
2. **‚ùå Creating placeholders** - Use localhost assets from Figma MCP
3. **‚ùå Ignoring localhost URLs** - If MCP provides `localhost:XXXX/assets/...`, USE IT

### Code & Design
4. **Skipping get_screenshot** - Always validate visually
5. **Hardcoding colors** - Use design tokens: `colors.brown` not `#421d13`
6. **Creating duplicate components** - Check `src/components/ui/` first
7. **Ignoring responsive design** - Figma shows desktop, implement mobile too
8. **Not documenting Figma source** - Add comments with node ID
9. **Forgetting accessibility** - Add ARIA labels, semantic HTML
10. **Skipping build validation** - Always run `npm run build`

---

## üìù Example: Complete Flow

```typescript
// 1. Get code representation
const codeResponse = await mcp__figma__get_code({
  fileKey: "KBKaj4z9hPZRv26GbNFSUz",
  nodeId: "3211:1217",
  clientLanguages: "typescript,jsx",
  clientFrameworks: "react,nextjs,tailwind"
});

// 2. Get screenshot for validation
const screenshot = await mcp__figma__get_screenshot({
  fileKey: "KBKaj4z9hPZRv26GbNFSUz",
  nodeId: "3211:1217",
  clientLanguages: "typescript",
  clientFrameworks: "react"
});

// 3. Extract assets from response
const assets = codeResponse.assets;
// Example assets:
// {
//   "icon-home": "http://localhost:3845/assets/abc123.svg",
//   "bg-image": "http://localhost:3845/assets/def456.png"
// }

// 4. Translate to project conventions
/**
 * New Feature Component
 * Source: Figma node 3211:1217
 *
 * @component
 */
import React from 'react';
import Image from 'next/image';
import { TitleSubTitle } from '@/components/ui/Typography';
import { CardInsight } from '@/components/ui/Card';
import { colors } from '@/lib/design-tokens';

export function NewFeature() {
  return (
    <section className="py-12 md:py-20">
      <div className="container mx-auto px-4 md:px-8">
        <TitleSubTitle
          title="Feature Title"
          subtitle="Feature description from Figma"
        />

        {/* Using asset from Figma MCP - DO NOT replace with icon package */}
        <div className="flex items-center gap-4">
          <Image
            src="http://localhost:3845/assets/abc123.svg"
            alt="Home icon"
            width={24}
            height={24}
          />
          <CardInsight
            icon="lamp"
            title="Insight"
            description="Content from Figma design"
          />
        </div>
      </div>
    </section>
  );
}

// 4. Validate against screenshot
// 5. Test build: npm run build
// 6. Visual regression check
```

---

## üîó Quick Reference

- **Design Tokens**: `src/lib/design-tokens.ts`
- **UI Components**: `src/components/ui/`
- **Existing Buttons**: `src/components/Button.tsx`
- **Color Palette**: Browns, beiges, orange accent
- **Fonts**: Playfair Display, Roboto Flex, Raleway, Comfortaa
- **Framework**: Next.js 15, React 19, Tailwind v4
- **Animations**: Framer Motion with `whileInView`

---

**Last Updated**: 2025-10-04
**Project**: Natasha Buchler Portfolio
